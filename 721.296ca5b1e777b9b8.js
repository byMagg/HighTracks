"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[721],{76:(K,$,h)=>{h.d($,{GW:()=>b,dk:()=>P,oK:()=>u});var u=(()=>{return(x=u||(u={})).Prompt="PROMPT",x.Camera="CAMERA",x.Photos="PHOTOS",u;var x})(),b=(()=>{return(x=b||(b={})).Rear="REAR",x.Front="FRONT",b;var x})(),P=(()=>{return(x=P||(P={})).Uri="uri",x.Base64="base64",x.DataUrl="dataUrl",P;var x})()},7423:(K,$,h)=>{h.d($,{Uw:()=>k,fo:()=>_,xz:()=>B});var u=h(5861);typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"&&global;var E=(()=>{return(s=E||(E={})).Unimplemented="UNIMPLEMENTED",s.Unavailable="UNAVAILABLE",E;var s})();class B extends Error{constructor(r,i,g){super(r),this.message=r,this.code=i,this.data=g}}const t=s=>{var r,i,g,p,c;const T=s.CapacitorCustomPlatform||null,n=s.Capacitor||{},l=n.Plugins=n.Plugins||{},e=s.CapacitorPlatforms,a=(null===(r=null==e?void 0:e.currentPlatform)||void 0===r?void 0:r.getPlatform)||(()=>null!==T?T.name:(s=>{var r,i;return null!=s&&s.androidBridge?"android":null!==(i=null===(r=null==s?void 0:s.webkit)||void 0===r?void 0:r.messageHandlers)&&void 0!==i&&i.bridge?"ios":"web"})(s)),A=(null===(i=null==e?void 0:e.currentPlatform)||void 0===i?void 0:i.isNativePlatform)||(()=>"web"!==a()),W=(null===(g=null==e?void 0:e.currentPlatform)||void 0===g?void 0:g.isPluginAvailable)||(y=>{const w=it.get(y);return!!(null!=w&&w.platforms.has(a())||dt(y))}),dt=(null===(p=null==e?void 0:e.currentPlatform)||void 0===p?void 0:p.getPluginHeader)||(y=>{var w;return null===(w=n.PluginHeaders)||void 0===w?void 0:w.find(j=>j.name===y)}),it=new Map,pt=(null===(c=null==e?void 0:e.currentPlatform)||void 0===c?void 0:c.registerPlugin)||((y,w={})=>{const j=it.get(y);if(j)return console.warn(`Capacitor plugin "${y}" already registered. Cannot register plugins twice.`),j.proxy;const G=a(),H=dt(y);let L;const vt=function(){var Z=(0,u.Z)(function*(){return!L&&G in w?L=L="function"==typeof w[G]?yield w[G]():w[G]:null!==T&&!L&&"web"in w&&(L=L="function"==typeof w.web?yield w.web():w.web),L});return function(){return Z.apply(this,arguments)}}(),at=Z=>{let M;const I=(...S)=>{const F=vt().then(O=>{const N=((Z,M)=>{var I,S;if(!H){if(Z)return null===(S=Z[M])||void 0===S?void 0:S.bind(Z);throw new B(`"${y}" plugin is not implemented on ${G}`,E.Unimplemented)}{const F=null==H?void 0:H.methods.find(O=>M===O.name);if(F)return"promise"===F.rtype?O=>n.nativePromise(y,M.toString(),O):(O,N)=>n.nativeCallback(y,M.toString(),O,N);if(Z)return null===(I=Z[M])||void 0===I?void 0:I.bind(Z)}})(O,Z);if(N){const V=N(...S);return M=null==V?void 0:V.remove,V}throw new B(`"${y}.${Z}()" is not implemented on ${G}`,E.Unimplemented)});return"addListener"===Z&&(F.remove=(0,u.Z)(function*(){return M()})),F};return I.toString=()=>`${Z.toString()}() { [capacitor code] }`,Object.defineProperty(I,"name",{value:Z,writable:!1,configurable:!1}),I},ut=at("addListener"),gt=at("removeListener"),Tt=(Z,M)=>{const I=ut({eventName:Z},M),S=function(){var O=(0,u.Z)(function*(){const N=yield I;gt({eventName:Z,callbackId:N},M)});return function(){return O.apply(this,arguments)}}(),F=new Promise(O=>I.then(()=>O({remove:S})));return F.remove=(0,u.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield S()}),F},st=new Proxy({},{get(Z,M){switch(M){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return H?Tt:ut;case"removeListener":return gt;default:return at(M)}}});return l[y]=st,it.set(y,{name:y,proxy:st,platforms:new Set([...Object.keys(w),...H?[G]:[]])}),st});return n.convertFileSrc||(n.convertFileSrc=y=>y),n.getPlatform=a,n.handleError=y=>s.console.error(y),n.isNativePlatform=A,n.isPluginAvailable=W,n.pluginMethodNoop=(y,w,j)=>Promise.reject(`${j} does not have an implementation of "${w}".`),n.registerPlugin=pt,n.Exception=B,n.DEBUG=!!n.DEBUG,n.isLoggingEnabled=!!n.isLoggingEnabled,n.platform=n.getPlatform(),n.isNative=n.isNativePlatform(),n},U=(s=>s.Capacitor=t(s))(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),_=U.registerPlugin;class k{constructor(r){this.listeners={},this.windowListeners={},r&&(console.warn(`Capacitor WebPlugin "${r.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=r)}addListener(r,i){var g=this;this.listeners[r]||(this.listeners[r]=[]),this.listeners[r].push(i);const c=this.windowListeners[r];c&&!c.registered&&this.addWindowListener(c);const T=function(){var l=(0,u.Z)(function*(){return g.removeListener(r,i)});return function(){return l.apply(this,arguments)}}(),n=Promise.resolve({remove:T});return Object.defineProperty(n,"remove",{value:(l=(0,u.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield T()}),function(){return l.apply(this,arguments)})}),n;var l}removeAllListeners(){var r=this;return(0,u.Z)(function*(){r.listeners={};for(const i in r.windowListeners)r.removeWindowListener(r.windowListeners[i]);r.windowListeners={}})()}notifyListeners(r,i){const g=this.listeners[r];g&&g.forEach(p=>p(i))}hasListeners(r){return!!this.listeners[r].length}registerWindowListener(r,i){this.windowListeners[i]={registered:!1,windowEventName:r,pluginEventName:i,handler:g=>{this.notifyListeners(i,g)}}}unimplemented(r="not implemented"){return new U.Exception(r,E.Unimplemented)}unavailable(r="not available"){return new U.Exception(r,E.Unavailable)}removeListener(r,i){var g=this;return(0,u.Z)(function*(){const p=g.listeners[r];if(!p)return;const c=p.indexOf(i);g.listeners[r].splice(c,1),g.listeners[r].length||g.removeWindowListener(g.windowListeners[r])})()}addWindowListener(r){window.addEventListener(r.windowEventName,r.handler),r.registered=!0}removeWindowListener(r){r&&(window.removeEventListener(r.windowEventName,r.handler),r.registered=!1)}}const R=s=>encodeURIComponent(s).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),D=s=>s.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class X extends k{getCookies(){return(0,u.Z)(function*(){const r=document.cookie,i={};return r.split(";").forEach(g=>{if(g.length<=0)return;let[p,c]=g.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");p=D(p).trim(),c=D(c).trim(),i[p]=c}),i})()}setCookie(r){return(0,u.Z)(function*(){try{const i=R(r.key),g=R(r.value),p=`; expires=${(r.expires||"").replace("expires=","")}`,c=(r.path||"/").replace("path=",""),T=null!=r.url&&r.url.length>0?`domain=${r.url}`:"";document.cookie=`${i}=${g||""}${p}; path=${c}; ${T};`}catch(i){return Promise.reject(i)}})()}deleteCookie(r){return(0,u.Z)(function*(){try{document.cookie=`${r.key}=; Max-Age=0`}catch(i){return Promise.reject(i)}})()}clearCookies(){return(0,u.Z)(function*(){try{const r=document.cookie.split(";")||[];for(const i of r)document.cookie=i.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(r){return Promise.reject(r)}})()}clearAllCookies(){var r=this;return(0,u.Z)(function*(){try{yield r.clearCookies()}catch(i){return Promise.reject(i)}})()}}_("CapacitorCookies",{web:()=>new X});const tt=function(){var s=(0,u.Z)(function*(r){return new Promise((i,g)=>{const p=new FileReader;p.onload=()=>{const c=p.result;i(c.indexOf(",")>=0?c.split(",")[1]:c)},p.onerror=c=>g(c),p.readAsDataURL(r)})});return function(i){return s.apply(this,arguments)}}();class ot extends k{request(r){return(0,u.Z)(function*(){const i=((s,r={})=>{const i=Object.assign({method:s.method||"GET",headers:s.headers},r),p=((s={})=>{const r=Object.keys(s);return Object.keys(s).map(p=>p.toLocaleLowerCase()).reduce((p,c,T)=>(p[c]=s[r[T]],p),{})})(s.headers)["content-type"]||"";if("string"==typeof s.data)i.body=s.data;else if(p.includes("application/x-www-form-urlencoded")){const c=new URLSearchParams;for(const[T,n]of Object.entries(s.data||{}))c.set(T,n);i.body=c.toString()}else if(p.includes("multipart/form-data")){const c=new FormData;if(s.data instanceof FormData)s.data.forEach((n,l)=>{c.append(l,n)});else for(const n of Object.keys(s.data))c.append(n,s.data[n]);i.body=c;const T=new Headers(i.headers);T.delete("content-type"),i.headers=T}else(p.includes("application/json")||"object"==typeof s.data)&&(i.body=JSON.stringify(s.data));return i})(r,r.webFetchExtra),g=((s,r=!0)=>s?Object.entries(s).reduce((g,p)=>{const[c,T]=p;let n,l;return Array.isArray(T)?(l="",T.forEach(e=>{n=r?encodeURIComponent(e):e,l+=`${c}=${n}&`}),l.slice(0,-1)):(n=r?encodeURIComponent(T):T,l=`${c}=${n}`),`${g}&${l}`},"").substr(1):null)(r.params,r.shouldEncodeUrlParams),p=g?`${r.url}?${g}`:r.url,c=yield fetch(p,i),T=c.headers.get("content-type")||"";let l,e,{responseType:n="text"}=c.ok?r:{};switch(T.includes("application/json")&&(n="json"),n){case"arraybuffer":case"blob":e=yield c.blob(),l=yield tt(e);break;case"json":l=yield c.json();break;default:l=yield c.text()}const o={};return c.headers.forEach((a,f)=>{o[f]=a}),{data:l,headers:o,status:c.status,url:c.url}})()}get(r){var i=this;return(0,u.Z)(function*(){return i.request(Object.assign(Object.assign({},r),{method:"GET"}))})()}post(r){var i=this;return(0,u.Z)(function*(){return i.request(Object.assign(Object.assign({},r),{method:"POST"}))})()}put(r){var i=this;return(0,u.Z)(function*(){return i.request(Object.assign(Object.assign({},r),{method:"PUT"}))})()}patch(r){var i=this;return(0,u.Z)(function*(){return i.request(Object.assign(Object.assign({},r),{method:"PATCH"}))})()}delete(r){var i=this;return(0,u.Z)(function*(){return i.request(Object.assign(Object.assign({},r),{method:"DELETE"}))})()}}_("CapacitorHttp",{web:()=>new ot})},9425:(K,$,h)=>{h.d($,{a:()=>c,H:()=>T});var u=h(5861),b=h(6895),P=h(433),x=h(1194),v=h(650);class J{constructor(l,e,o){this._id=l,o&&(this._id=o),this.name=l,this.album=e}}class z{constructor(l,e,o){this.name=e,this.artists=[{name:l}],this.images=[{url:o}]}}var E=h(7423),B=h(76);const Q=(0,E.fo)("Camera",{web:()=>h.e(3954).then(h.bind(h,3954)).then(n=>new n.CameraWeb)});var t=h(4650),C=h(8672),U=h(7556);function _(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"ion-segment-button",18),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.changeParams())}),t._uU(1),t.qZA()}if(2&n){const e=l.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function d(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"ion-segment",16),t.NdJ("ngModelChange",function(a){t.CHM(e);const f=t.oxw();return t.KtG(f.filter=a)}),t.YNc(1,_,2,2,"ion-segment-button",17),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("ngModel",e.filter),t.xp6(1),t.Q6J("ngForOf",e.searchFilters)}}function m(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"ion-buttons",19)(1,"ion-button",6),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.toggleInsertTrack())}),t._uU(2),t.qZA(),t.TgZ(3,"ion-fab-button",20),t._UZ(4,"ion-icon",21),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(2),t.hij(" ",e.toggleInsert?"Mostrar listado":"Buscar spotify"," ")}}function k(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",22),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.insertTracks())}),t._UZ(1,"ion-icon",23),t._uU(2),t.qZA()}if(2&n){const e=t.oxw();t.xp6(2),t.hij(" A\xf1adir ",e.tracksToBeAdded.length," canciones ")}}function q(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item")(1,"ion-label",26),t._uU(2,"URL imagen"),t.qZA(),t.TgZ(3,"ion-input",33),t.NdJ("ngModelChange",function(a){t.CHM(e);const f=t.oxw(2);return t.KtG(f.trackToAdd.album.images[0].url=a)}),t.qZA()()}if(2&n){const e=t.oxw(2);t.xp6(3),t.Q6J("ngModel",e.trackToAdd.album.images[0].url)}}function R(n,l){1&n&&t._UZ(0,"ion-img",39)}function D(n,l){if(1&n&&t._UZ(0,"ion-img",14),2&n){const e=t.oxw(3);t.Q6J("src","data:image/jpeg;base64,"+e.trackToAdd.album.images[0].imageBase64String)}}function X(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"div",34),t.YNc(1,R,1,0,"ion-img",35),t.YNc(2,D,1,1,"ion-img",36),t.TgZ(3,"ion-fab",37)(4,"ion-fab-button",6),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.takePicture())}),t._UZ(5,"ion-icon",38),t.qZA()()()}if(2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",!e.trackToAdd.album.images[0].imageBase64String),t.xp6(1),t.Q6J("ngIf",e.trackToAdd.album.images[0].imageBase64String)}}function ct(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3,"A\xf1adir canci\xf3n"),t.qZA(),t.TgZ(4,"ion-buttons",19)(5,"ion-button",6),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.cancel())}),t._uU(6,"Cancelar"),t.qZA(),t.TgZ(7,"ion-button",24),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.confirm(a.trackToAdd))}),t._uU(8,"A\xf1adir"),t.qZA()()()(),t.TgZ(9,"ion-content",25)(10,"ion-item")(11,"ion-label",26),t._uU(12,"Nombre"),t.qZA(),t.TgZ(13,"ion-input",27),t.NdJ("ngModelChange",function(a){t.CHM(e);const f=t.oxw();return t.KtG(f.trackToAdd.name=a)}),t.qZA()(),t.TgZ(14,"ion-item")(15,"ion-label",26),t._uU(16,"Artista/Grupo"),t.qZA(),t.TgZ(17,"ion-input",28),t.NdJ("ngModelChange",function(a){t.CHM(e);const f=t.oxw();return t.KtG(f.trackToAdd.album.artists[0].name=a)}),t.qZA()(),t.TgZ(18,"ion-segment",16),t.NdJ("ngModelChange",function(a){t.CHM(e);const f=t.oxw();return t.KtG(f.togglePhoto=a)}),t.TgZ(19,"ion-segment-button",29)(20,"ion-label"),t._uU(21,"URL"),t.qZA()(),t.TgZ(22,"ion-segment-button",30)(23,"ion-label"),t._uU(24,"Imagen"),t.qZA()()(),t.YNc(25,q,4,1,"ion-item",31),t.YNc(26,X,6,2,"div",32),t.qZA()}if(2&n){const e=t.oxw();t.xp6(7),t.Q6J("strong",!0),t.xp6(6),t.Q6J("ngModel",e.trackToAdd.name),t.xp6(4),t.Q6J("ngModel",e.trackToAdd.album.artists[0].name),t.xp6(1),t.Q6J("ngModel",e.togglePhoto),t.xp6(7),t.Q6J("ngIf","url"===e.togglePhoto),t.xp6(1),t.Q6J("ngIf","img"===e.togglePhoto)}}function tt(n,l){1&n&&t._UZ(0,"ion-icon",52)}function et(n,l){1&n&&t._UZ(0,"ion-icon",53)}function nt(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"ion-fab-button",49),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().$implicit,f=t.oxw(),A=t.MAs(22);return t.KtG(f.changePreview(A.src!=a.preview_url?a.preview_url:"",A))}),t.YNc(1,tt,1,0,"ion-icon",50),t.YNc(2,et,1,0,"ion-icon",51),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.oxw();const o=t.MAs(22);t.xp6(1),t.Q6J("ngIf",o.src!=e.preview_url),t.xp6(1),t.Q6J("ngIf",o.src==e.preview_url)}}function rt(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"ion-fab-button",54),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().$implicit,f=t.oxw();return t.KtG(f.tracksToBeAdded.push(a)&&f.test())}),t._UZ(1,"ion-icon",21),t.qZA()}}function ot(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"ion-fab-button",55),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().$implicit,f=t.oxw();return t.KtG(f.tracksToBeAdded.splice(f.tracksToBeAdded.indexOf(a),1)&&f.test())}),t._UZ(1,"ion-icon",56),t.qZA()}}function lt(n,l){1&n&&(t.TgZ(0,"ion-fab-button",57),t._UZ(1,"ion-icon",58),t.qZA())}function s(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"ion-fab-list")(1,"ion-fab-button")(2,"ion-icon",59),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().$implicit,f=t.oxw();return t.KtG(f.navigateToTrackEdit(a._id))}),t.qZA()(),t.TgZ(3,"ion-fab-button",60),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().$implicit,f=t.oxw();return t.KtG(f.handleDeleteAlert(a._id))}),t._UZ(4,"ion-icon",61),t.qZA()()}}function r(n,l){if(1&n&&t._UZ(0,"ion-img",14),2&n){const e=t.oxw().$implicit;t.s9C("src",e.album.images[0].url)}}function i(n,l){if(1&n&&t._UZ(0,"ion-img",14),2&n){const e=t.oxw().$implicit;t.Q6J("src","data:image/jpeg;base64,"+e.album.images[0].imageBase64String)}}function g(n,l){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&n){const e=l.$implicit;t.xp6(1),t.Oqu(e.name)}}function p(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"ion-card",40),t.YNc(1,nt,3,2,"ion-fab-button",41),t.TgZ(2,"ion-fab"),t.YNc(3,rt,2,0,"ion-fab-button",42),t.YNc(4,ot,2,0,"ion-fab-button",43),t.YNc(5,lt,2,0,"ion-fab-button",44),t.YNc(6,s,5,0,"ion-fab-list",31),t.qZA(),t.TgZ(7,"div",45),t.NdJ("click",function(){const f=t.CHM(e).$implicit,A=t.oxw();return t.KtG(!A.toggleInsert&&A.navigateToTrack(f._id))}),t.TgZ(8,"div",46),t.YNc(9,r,1,1,"ion-img",36),t.YNc(10,i,1,1,"ion-img",36),t.qZA(),t.TgZ(11,"div",47)(12,"div")(13,"p"),t._uU(14),t.qZA()(),t.TgZ(15,"div"),t.YNc(16,g,2,1,"p",48),t.qZA(),t.TgZ(17,"div")(18,"p"),t._uU(19),t.ALo(20,"date"),t.qZA()()()()()}if(2&n){const e=l.$implicit,o=t.oxw();t.xp6(1),t.Q6J("ngIf",e.preview_url),t.xp6(2),t.Q6J("ngIf",o.toggleInsert&&!o.tracksToBeAdded.includes(e)),t.xp6(1),t.Q6J("ngIf",o.toggleInsert&&o.tracksToBeAdded.includes(e)),t.xp6(1),t.Q6J("ngIf",!o.toggleInsert&&o.displayInsert),t.xp6(1),t.Q6J("ngIf",!o.toggleInsert&&o.displayInsert),t.xp6(3),t.Q6J("ngIf",e.album.images[0].url),t.xp6(1),t.Q6J("ngIf",e.album.images[0].imageBase64String),t.xp6(4),t.Oqu(e.name),t.xp6(2),t.Q6J("ngForOf",e.album.artists),t.xp6(3),t.hij("",t.xi3(20,10,e.duration_ms,"mm:ss")," min")}}var c=(()=>{return(n=c||(c={})).name="name",n.artist="artist",n.date="date",c;var n})();let T=(()=>{class n{constructor(e,o,a,f,A,Y){this.apiService=e,this.route=o,this.authService=a,this.router=f,this.alertCtrl=A,this.toastCtrl=Y,this.toggleInsert=!1,this.displayInsert=!1,this.filter=c.name,this.searchFilters=Object.values(c),this.trackToAdd=new J("",new z("","","")),this.togglePhoto="url",this.tracksToBeAdded=[],this.route.queryParams.subscribe(W=>{this.displayInsert=this.authService.checkLogged(),this.query=W.s,Object.keys(c).includes(W.f)&&(this.filter=W.f),this.search()})}changePreview(e,o){o.src=e,o.play()}handleDeleteAlert(e){this.alertCtrl.create({header:"Confirmar eliminaci\xf3n",message:"\xbfEst\xe1s seguro de que quieres eliminar esta canci\xf3n?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"confirm",handler:()=>{var o;this.deleteTrack(e),this.tracks=null===(o=this.tracks)||void 0===o?void 0:o.filter(a=>a._id!=e)}}]}).then(o=>o.present())}test(){console.log(this.tracksToBeAdded)}cancel(){this.modal&&this.modal.dismiss(null,"cancel")}confirm(e){this.modal&&this.modal.dismiss(e,"confirm")}onWillDismiss(e){const o=e;var a;console.log("Will dismiss with: ",o.detail),"confirm"===o.detail.role&&o.detail.data&&(o.detail.data._id=null===(a=o.detail.data)||void 0===a?void 0:a.name,"url"==this.togglePhoto&&(o.detail.data.album.images[0].imageBase64String=void 0),"img"==this.togglePhoto&&(o.detail.data.album.images[0].url=void 0),this.insertTrack(o.detail.data))}changeParams(){let e={s:this.query,f:this.filter};""==this.query&&(e.s=void 0),this.router.navigate([],{relativeTo:this.route,queryParams:e,queryParamsHandling:"merge"})}navigateToTrack(e){this.router.navigate([`/tracks/${e}`])}navigateToTrackEdit(e){this.router.navigate([`/tracks/${e}/edit`])}toggleInsertTrack(){this.toggleInsert=!this.toggleInsert,this.search()}search(){this.changeParams(),this.query?this.toggleInsert?this.searchSpotify(this.query):this.searchDB(this.query):this.toggleInsert?this.tracks=[]:this.getAllTracks()}searchSpotify(e){var o=this;return(0,u.Z)(function*(){const a=yield o.apiService.searchTracksSpotify(e),f=yield o.apiService.getTracks();for(let A of a)A.inserted=!!f.find(Y=>Y._id==A._id);o.tracks=a.filter(A=>0==A.inserted)})()}searchDB(e){var o=this;return(0,u.Z)(function*(){try{o.tracks=yield o.apiService.searchTracks(e,o.filter)}catch(a){a instanceof Error&&console.error(a.message)}})()}getAllTracks(){var e=this;return(0,u.Z)(function*(){try{e.tracks=yield e.apiService.getTracks()}catch(o){o instanceof Error&&console.error(o.message)}})()}insertTrack(e){var o=this;return(0,u.Z)(function*(){var a;yield o.apiService.insertTrack(e),o.tracks=null===(a=o.tracks)||void 0===a?void 0:a.filter(f=>f._id!=e._id),o.toastCtrl.create({message:"Canci\xf3n insertada correctamente",duration:2e3}).then(f=>f.present())})()}insertTracks(){var e=this;return(0,u.Z)(function*(){0!=e.tracksToBeAdded.length&&(yield e.apiService.insertTracks(e.tracksToBeAdded),e.tracksToBeAdded=[],e.toastCtrl.create({message:"Canciones insertadas correctamente",duration:2e3}).then(o=>o.present()),e.query="",e.toggleInsertTrack())})()}deleteTrack(e){var o=this;return(0,u.Z)(function*(){console.log("deleteTrack: "+e),(yield o.apiService.deleteTrack(e))?o.toastCtrl.create({message:"Canci\xf3n eliminada correctamente",duration:2e3}).then(f=>f.present()):o.toastCtrl.create({message:"No se ha podido eliminar la canci\xf3n",duration:2e3}).then(f=>f.present())})()}takePicture(){var e=this;return(0,u.Z)(function*(){const o=yield Q.getPhoto({quality:100,allowEditing:!1,resultType:B.dk.Base64});o&&o.base64String&&(e.trackToAdd.album.images[0]={imageBase64String:o.base64String})})()}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(C.j),t.Y36(x.gz),t.Y36(U.e),t.Y36(x.F0),t.Y36(v.Br),t.Y36(v.yF))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-tracks"]],viewQuery:function(e,o){if(1&e&&t.Gf(v.ki,5),2&e){let a;t.iGM(a=t.CRH())&&(o.modal=a.first)}},standalone:!0,features:[t.jDz],decls:23,vars:7,consts:[["slot","start"],["defaultHref","/"],[3,"ngModel","ngModelChange",4,"ngIf"],["slot","end",4,"ngIf"],["id","searchBar"],["mode","ios","placeholder","Introduce el nombre de la canci\xf3n",3,"ngModel","keyup.enter","ngModelChange"],[3,"click"],["slot","end","name","search"],["id","addTracks","color","success","shape","round",3,"click",4,"ngIf"],["id","container"],["trigger","open-modal",3,"willDismiss"],[3,"fixed"],[1,"ion-justify-content-center"],["button","","class","card",4,"ngFor","ngForOf"],[3,"src"],["ref",""],[3,"ngModel","ngModelChange"],[3,"value","click",4,"ngFor","ngForOf"],[3,"value","click"],["slot","end"],["id","open-modal","size","small"],["name","add"],["id","addTracks","color","success","shape","round",3,"click"],["name","checkmark"],["color","primary",3,"strong","click"],[1,"ion-padding"],["position","stacked"],["type","text","aria-label","Nombre","placeholder","Nombre de la canci\xf3n",3,"ngModel","ngModelChange"],["type","text","aria-label","Artista","placeholder","Artista o grupo",3,"ngModel","ngModelChange"],["value","url"],["value","img"],[4,"ngIf"],["style","padding: 45px 0;",4,"ngIf"],["type","text","aria-label","URL","placeholder","URL de la imagen",3,"ngModel","ngModelChange"],[2,"padding","45px 0"],["src","../../../assets/placeholder.png",4,"ngIf"],[3,"src",4,"ngIf"],["vertical","bottom","horizontal","center","slot","fixed"],["name","camera"],["src","../../../assets/placeholder.png"],["button","",1,"card"],["size","small","class","playButton",3,"click",4,"ngIf"],["size","small",3,"click",4,"ngIf"],["color","danger","size","small",3,"click",4,"ngIf"],["size","small","color","light",4,"ngIf"],[1,"card",3,"click"],["id","img-container"],["id","card-info"],[4,"ngFor","ngForOf"],["size","small",1,"playButton",3,"click"],["name","play",4,"ngIf"],["name","pause",4,"ngIf"],["name","play"],["name","pause"],["size","small",3,"click"],["color","danger","size","small",3,"click"],["name","close"],["size","small","color","light"],["name","ellipsis-vertical"],["name","pencil",3,"click"],["id","delete-alert",3,"click"],["name","trash","color","danger"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t.YNc(5,d,2,2,"ion-segment",2),t.qZA(),t.YNc(6,m,5,1,"ion-buttons",3),t.qZA(),t.TgZ(7,"ion-toolbar")(8,"div",4)(9,"ion-searchbar",5),t.NdJ("keyup.enter",function(){return o.search()})("ngModelChange",function(f){return o.query=f}),t.qZA(),t.TgZ(10,"ion-button",6),t.NdJ("click",function(){return o.search()}),t._UZ(11,"ion-icon",7),t._uU(12," Buscar "),t.qZA()()(),t.YNc(13,k,3,1,"ion-button",8),t.qZA(),t.TgZ(14,"ion-content")(15,"div",9)(16,"ion-modal",10),t.NdJ("willDismiss",function(f){return o.onWillDismiss(f)}),t.YNc(17,ct,27,6,"ng-template"),t.qZA(),t.TgZ(18,"ion-grid",11)(19,"ion-row",12),t.YNc(20,p,21,13,"ion-card",13),t.qZA()()(),t._UZ(21,"audio",14,15),t.qZA()),2&e&&(t.xp6(5),t.Q6J("ngIf",!o.toggleInsert),t.xp6(1),t.Q6J("ngIf",o.displayInsert),t.xp6(3),t.Q6J("ngModel",o.query),t.xp6(4),t.Q6J("ngIf",o.toggleInsert&&0!=o.tracksToBeAdded.length),t.xp6(5),t.Q6J("fixed",!0),t.xp6(2),t.Q6J("ngForOf",o.tracks),t.xp6(1),t.Q6J("src",o.previewToPlay,t.LSH))},dependencies:[b.ez,b.sg,b.O5,b.uU,P.u5,P.JJ,P.On,v.Pc,v.oU,v.YG,v.Sm,v.PM,v.W2,v.IJ,v.W4,v.zq,v.jY,v.Gu,v.gu,v.Xz,v.pK,v.Ie,v.Q$,v.Nd,v.VI,v.cJ,v.GO,v.wd,v.sr,v.ki,v.QI,v.j9,v.cs,x.Bz],styles:['ion-card[_ngcontent-%COMP%]{width:200px;position:relative;height:300px;background-color:#000;transition:.5s}ion-card[_ngcontent-%COMP%]:hover{transform:scale(1.1)}ion-img[_ngcontent-%COMP%]{height:100%}ion-card[_ngcontent-%COMP%]   ion-fab[_ngcontent-%COMP%]{position:absolute;z-index:1;top:0;right:0}#img-container[_ngcontent-%COMP%]{position:relative}#img-container[_ngcontent-%COMP%]:after{content:"";position:absolute;left:0;top:0;width:100%;height:100%;background:linear-gradient(to bottom,rgba(255,255,255,0) 0,black 100%)}#card-info[_ngcontent-%COMP%]{position:absolute;bottom:0;width:100%}#card-info[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{background-color:#000;color:#fff;text-align:center;border-radius:5px;margin:0 auto;width:max-content;padding:0 10px;max-width:80%;box-shadow:0 0 130px 30px var(--ion-color-primary)}#searchBar[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:500px;margin:0 auto}#searchBar[_ngcontent-%COMP%]   ion-searchbar[_ngcontent-%COMP%]{padding:0 20px}ion-segment[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;margin:0 auto}ion-modal[_ngcontent-%COMP%]   ion-img[_ngcontent-%COMP%]{width:45%;margin:0 auto}#addTracks[_ngcontent-%COMP%]{position:fixed;top:62px;right:20px;z-index:10}.playButton[_ngcontent-%COMP%]{position:absolute;z-index:100;opacity:0;transition:opacity .3s ease-in-out}.card[_ngcontent-%COMP%]:hover   .playButton[_ngcontent-%COMP%]{opacity:1}@media (max-width: 1075px){#addTracks[_ngcontent-%COMP%]{bottom:50px;right:50px;top:unset}}@media (max-width: 768px){ion-modal[_ngcontent-%COMP%]   ion-img[_ngcontent-%COMP%]{width:90%;margin:0 auto}}']}),n})()},721:(K,$,h)=>{h.r($),h.d($,{routes:()=>b});const b=[{path:"",component:h(9425).H},{path:":id",loadComponent:()=>h.e(6845).then(h.bind(h,6845)).then(P=>P.TrackPage)},{path:":id/edit",loadComponent:()=>h.e(9077).then(h.bind(h,9077)).then(P=>P.EditPage)}]},8672:(K,$,h)=>{h.d($,{j:()=>t});var u=h(5861),b=h(529),P=h(9808),x=h(2340),v=h(9425),J=h(4650),z=h(7556);const B=(0,h(7423).fo)("Geolocation",{web:()=>h.e(4561).then(h.bind(h,4561)).then(C=>new C.GeolocationWeb)});let Q=(()=>{class C{constructor(){this.coords={latitude:0,longitude:0,accuracy:0}}getLocation(){var _=this;return(0,u.Z)(function*(){const d=yield B.getCurrentPosition();return _.coords.latitude=d.coords.latitude,_.coords.latitude=d.coords.longitude,_.coords.accuracy=d.coords.accuracy,_.coords})()}}return C.\u0275fac=function(_){return new(_||C)},C.\u0275prov=J.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})(),t=(()=>{class C{constructor(_,d,m){this.http=_,this.authService=d,this.geoService=m,this.url=x.N.url,this.token=this.authService.getJWT()}searchTracksSpotify(_){var d=this;return(0,u.Z)(function*(){try{const m=(yield(0,P.n)(d.http.get(`${d.url}search/${encodeURI(_)}`))).tracks.items;return console.log(m),m.map(k=>({_id:k.id,...k,id:void 0}))}catch(m){return console.log(m),[]}})()}searchTracks(_,d=v.a.name){var m=this;return(0,u.Z)(function*(){try{return yield(0,P.n)(m.http.get(`${m.url}tracks/search?${d}=${encodeURI(_)}`,{headers:{Authorization:`Bearer ${m.token}`}}))}catch(k){if(k instanceof b.UA){if(404===k.status)throw new Error("Track not found");if(500===k.status)throw new Error("Error getting track");if(0===k.status)throw new Error("Error connecting to server")}throw k}})()}getTrack(_){var d=this;return(0,u.Z)(function*(){try{return yield(0,P.n)(d.http.get(`${d.url}tracks/${_}`,{headers:{Authorization:`Bearer ${d.token}`}}))}catch(m){if(m instanceof b.UA){if(404===m.status)throw new Error("Track not found");if(500===m.status)throw new Error("Error getting track");if(0===m.status)throw new Error("Error connecting to server")}throw m}})()}getTracks(){var _=this;return(0,u.Z)(function*(){try{return yield(0,P.n)(_.http.get(`${_.url}tracks/`,{headers:{Authorization:`Bearer ${_.token}`}}))}catch(d){if(d instanceof b.UA){if(500===d.status)throw new Error("Error getting track");if(0===d.status)throw new Error("Error connecting to server")}}return[]})()}insertTrack(_){var d=this;return(0,u.Z)(function*(){const m=yield d.geoService.getLocation();_.location=m;try{return yield(0,P.n)(d.http.post(`${d.url}tracks/`,_,{headers:{Authorization:`Bearer ${d.token}`}})),!0}catch(k){if(k instanceof b.UA&&400===k.status)throw Error("Track already exists");return!1}})()}insertTracks(_){var d=this;return(0,u.Z)(function*(){const m=yield d.geoService.getLocation();_.forEach(k=>k.location=m);try{return yield(0,P.n)(d.http.post(`${d.url}tracks/`,_,{headers:{Authorization:`Bearer ${d.token}`}})),!0}catch(k){if(k instanceof b.UA&&400===k.status)throw Error("Track already exists");return!1}})()}insertComment(_,d){var m=this;return(0,u.Z)(function*(){const k=yield m.geoService.getLocation();d.location=k,console.log(d);try{return yield(0,P.n)(m.http.post(`${m.url}tracks/${_}/comments`,d,{headers:{Authorization:`Bearer ${m.token}`}})),!0}catch(q){return q instanceof b.UA&&404===q.status&&console.log("Track not found"),!1}})()}updateTrack(_){var d=this;return(0,u.Z)(function*(){try{return yield(0,P.n)(d.http.put(`${d.url}tracks/${_._id}`,_,{headers:{Authorization:`Bearer ${d.token}`}})),!0}catch(m){return m instanceof b.UA&&(404===m.status&&console.log("Track not found"),500===m.status&&console.log("Error updating track")),!1}})()}deleteTrack(_){var d=this;return(0,u.Z)(function*(){try{return yield(0,P.n)(d.http.delete(`${d.url}tracks/${_}`,{headers:{Authorization:`Bearer ${d.token}`}})),!0}catch(m){return m instanceof b.UA&&(404===m.status&&console.log("Track not found"),500===m.status&&console.log("Error deleting track")),!1}})()}getComments(_){var d=this;return(0,u.Z)(function*(){let m=[];try{m=yield(0,P.n)(d.http.get(`${d.url}tracks/${_}/comments`,{headers:{Authorization:`Bearer ${d.token}`}})),console.log(m)}catch(k){k instanceof b.UA&&(404===k.status&&console.log("Track not found"),500===k.status&&console.log("Error getting comments"))}return m})()}deleteComment(_,d){var m=this;return(0,u.Z)(function*(){try{return yield(0,P.n)(m.http.delete(`${m.url}tracks/${_}/comments/${d}`,{headers:{Authorization:`Bearer ${m.token}`}})),!0}catch(k){return k instanceof b.UA&&(404===k.status&&console.log("Track not found"),500===k.status&&console.log("Error deleting comment")),!1}})()}}return C.\u0275fac=function(_){return new(_||C)(J.LFG(b.eN),J.LFG(z.e),J.LFG(Q))},C.\u0275prov=J.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()}}]);