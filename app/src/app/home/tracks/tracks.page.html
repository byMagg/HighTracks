<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/"></ion-back-button>
    </ion-buttons>
    <ion-title>
      <ion-segment [(ngModel)]="filter" *ngIf="!toggleInsert">
        <ion-segment-button (click)="changeParams()" [value]="enum" *ngFor="let enum of searchFilters;">
          {{enum}}
        </ion-segment-button>
      </ion-segment>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button *ngIf="displayInsert" (click)="toggleInsertTrack()">
        {{toggleInsert ? 'Mostrar listado' : 'Buscar spotify'}}
      </ion-button>
      <ion-fab-button id="open-modal" size="small">
        <ion-icon name="add"></ion-icon>
      </ion-fab-button>
    </ion-buttons>

  </ion-toolbar>
  <ion-toolbar>
    <div id="searchBar">
      <ion-searchbar mode="ios" (keyup.enter)="search()" [(ngModel)]="query"
        placeholder="Introduce el nombre de la canción"></ion-searchbar>
      <ion-button (click)="search()"><ion-icon slot="end" name="search"></ion-icon>
        Buscar
      </ion-button>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content>

  <div id="container">
    <ion-modal trigger="open-modal" (willDismiss)="onWillDismiss($event)">
      <ng-template>
        <ion-header>
          <ion-toolbar>
            <ion-title>Añadir canción</ion-title>
            <ion-buttons slot="end">
              <ion-button (click)="cancel()">Cancelar</ion-button>
              <ion-button (click)="confirm(trackToAdd)" color="primary" [strong]="true">Añadir</ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header>
        <ion-content class="ion-padding">
          <ion-item>
            <ion-label position="stacked">Nombre</ion-label>
            <ion-input type="text" aria-label="Nombre" [(ngModel)]="trackToAdd.name"
              placeholder="Nombre de la canción"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="stacked">Artista/Grupo</ion-label>
            <ion-input type="text" aria-label="Artista" [(ngModel)]="trackToAdd.album.artists[0].name"
              placeholder="Artista o grupo"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="stacked">URL imagen</ion-label>
            <ion-input type="text" aria-label="URL" [(ngModel)]="trackToAdd.album.images[0].url"
              placeholder="URL de la imagen"></ion-input>
          </ion-item>
        </ion-content>
      </ng-template>
    </ion-modal>
    <ion-grid [fixed]="true">
      <ion-row class="ion-justify-content-center">
        <ion-card button *ngFor="let track of tracks">
          <ion-fab>
            <ion-fab-button size="small" *ngIf="toggleInsert && !track.inserted" (click)="insertTrack(track)">
              <ion-icon name="add"></ion-icon>
            </ion-fab-button>
            <ion-fab-button size="small" color="light" *ngIf="!toggleInsert && displayInsert">
              <ion-icon name="ellipsis-vertical"></ion-icon>
            </ion-fab-button>
            <ion-fab-list *ngIf="!toggleInsert && displayInsert">
              <ion-fab-button>
                <ion-icon name="pencil" (click)="navigateToTrackEdit(track._id)"></ion-icon>
              </ion-fab-button>
              <ion-fab-button id="delete-alert" (click)="handleDeleteAlert(track._id)">
                <ion-icon name="trash" color="danger"></ion-icon>
              </ion-fab-button>
            </ion-fab-list>
          </ion-fab>

          <div (click)="navigateToTrack(track._id)">
            <div id="img-container">
              <ion-img src="{{track.album.images[0].url}}"></ion-img>
            </div>
            <div id="card-info">
              <div>
                <p>{{track.name}}</p>
              </div>
              <div>
                <p *ngFor="let artist of track.album.artists">{{artist.name}}</p>
              </div>
              <div>
                <p>{{( track.duration_ms | date:'mm:ss')}} min</p>
              </div>
            </div>
          </div>
        </ion-card>
      </ion-row>
    </ion-grid>
  </div>
</ion-content>