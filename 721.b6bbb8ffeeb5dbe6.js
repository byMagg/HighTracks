"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[721],{9226:(A,T,a)=>{a.d(T,{a:()=>p,H:()=>Z});var u=a(6895),_=a(433),d=a(2607),r=a(4709);class x{constructor(l,e){this._id="",this.name=l,this.album=e}}class f{constructor(l,e,n){this.name=e,this.artists=[{name:l}],this.images=[{url:n}]}}var b=a(7556),t=a(4650),P=a(5013);function h(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-segment-button",18),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.changeParams())}),t._uU(1),t.qZA()}if(2&o){const e=l.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function v(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-segment",16),t.NdJ("ngModelChange",function(i){t.CHM(e);const g=t.oxw();return t.KtG(g.filter=i)}),t.YNc(1,h,2,2,"ion-segment-button",17),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("ngModel",e.filter),t.xp6(1),t.Q6J("ngForOf",e.searchFilters)}}function s(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-button",9),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.toggleInsertTrack())}),t._uU(1),t.qZA()}if(2&o){const e=t.oxw();t.xp6(1),t.hij(" ",e.toggleInsert?"Mostrar listado":"Buscar spotify"," ")}}function c(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3,"A\xf1adir canci\xf3n"),t.qZA(),t.TgZ(4,"ion-buttons",3)(5,"ion-button",9),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.cancel())}),t._uU(6,"Cancelar"),t.qZA(),t.TgZ(7,"ion-button",19),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.confirm(i.trackToAdd))}),t._uU(8,"A\xf1adir"),t.qZA()()()(),t.TgZ(9,"ion-content",20)(10,"ion-item")(11,"ion-label",21),t._uU(12,"Nombre"),t.qZA(),t.TgZ(13,"ion-input",22),t.NdJ("ngModelChange",function(i){t.CHM(e);const g=t.oxw();return t.KtG(g.trackToAdd.name=i)}),t.qZA()(),t.TgZ(14,"ion-item")(15,"ion-label",21),t._uU(16,"Artista/Grupo"),t.qZA(),t.TgZ(17,"ion-input",23),t.NdJ("ngModelChange",function(i){t.CHM(e);const g=t.oxw();return t.KtG(g.trackToAdd.album.artists[0].name=i)}),t.qZA()(),t.TgZ(18,"ion-item")(19,"ion-label",21),t._uU(20,"URL imagen"),t.qZA(),t.TgZ(21,"ion-input",24),t.NdJ("ngModelChange",function(i){t.CHM(e);const g=t.oxw();return t.KtG(g.trackToAdd.album.images[0].url=i)}),t.qZA()()()}if(2&o){const e=t.oxw();t.xp6(7),t.Q6J("strong",!0),t.xp6(6),t.Q6J("ngModel",e.trackToAdd.name),t.xp6(4),t.Q6J("ngModel",e.trackToAdd.album.artists[0].name),t.xp6(4),t.Q6J("ngModel",e.trackToAdd.album.images[0].url)}}function m(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",31),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit,g=t.oxw();return t.KtG(g.insertTrack(i))}),t._UZ(1,"ion-icon",6),t.qZA()}}function M(o,l){if(1&o&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&o){const e=l.$implicit;t.xp6(1),t.Oqu(e.name)}}function C(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-card",25)(1,"ion-fab"),t.YNc(2,m,2,0,"ion-fab-button",26),t.qZA(),t.TgZ(3,"div",9),t.NdJ("click",function(){const g=t.CHM(e).$implicit,k=t.oxw();return t.KtG(k.navigateToTrack(g._id))}),t.TgZ(4,"div",27),t._UZ(5,"ion-img",28),t.qZA(),t.TgZ(6,"div",29)(7,"div")(8,"p"),t._uU(9),t.qZA()(),t.TgZ(10,"div"),t.YNc(11,M,2,1,"p",30),t.qZA(),t.TgZ(12,"div")(13,"p"),t._uU(14),t.ALo(15,"date"),t.qZA()()()()()}if(2&o){const e=l.$implicit,n=t.oxw();t.xp6(2),t.Q6J("ngIf",n.toggleInsert),t.xp6(3),t.s9C("src",e.album.images[0].url),t.xp6(4),t.Oqu(e.name),t.xp6(2),t.Q6J("ngForOf",e.album.artists),t.xp6(3),t.hij("",t.xi3(15,5,e.duration_ms,"mm:ss")," min")}}var p=(()=>{return(o=p||(p={})).name="name",o.artist="artist",o.date="date",p;var o})();let Z=(()=>{class o{constructor(e,n,i,g){this.apiService=e,this.route=n,this.authService=i,this.router=g,this.toggleInsert=!1,this.displayInsert=!1,this.filter=p.name,this.searchFilters=Object.values(p),this.trackToAdd=new x("",new f("","","")),this.route.queryParams.subscribe(k=>{this.displayInsert=this.authService.checkLogged(),console.log("DisplayInsert: "+this.displayInsert),console.log("ToggleInsert: "+this.toggleInsert),console.log("Logged: "+b.e.logged),this.query=k.s,Object.values(p).includes(k.f)&&(this.filter=k.f),this.search()})}cancel(){this.modal&&this.modal.dismiss(null,"cancel")}confirm(e){this.modal&&this.modal.dismiss(e,"confirm")}onWillDismiss(e){const n=e;var i;console.log("Will dismiss with: ",n.detail),"confirm"===n.detail.role&&n.detail.data&&(n.detail.data._id=null===(i=n.detail.data)||void 0===i?void 0:i.name,this.insertTrack(n.detail.data))}changeParams(){let e={s:this.query,f:this.filter};""==this.query&&(e.s=void 0),this.router.navigate([],{relativeTo:this.route,queryParams:e,queryParamsHandling:"merge"})}navigateToTrack(e){this.router.navigate([`/tracks/${e}`])}toggleInsertTrack(){this.toggleInsert=!this.toggleInsert,this.search()}search(){console.log(this.query),this.changeParams(),this.query?this.toggleInsert?this.searchSpotify(this.query):this.searchDB(this.query):this.getAllTracks()}searchSpotify(e){this.apiService.searchTracksSpotify(e).subscribe(n=>{this.tracks=n,console.log(this.tracks[0])})}searchDB(e){console.log("searchDB: "+e+" "+this.filter),this.apiService.searchTracks(e,this.filter).subscribe(n=>{this.tracks=n,console.log(this.tracks[0])})}getAllTracks(){this.apiService.getTracks().subscribe(e=>{this.tracks=e,console.log(this.tracks[0])})}insertTrack(e){this.apiService.insertTrack(e)}ngOnInit(){}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(P.j),t.Y36(d.gz),t.Y36(b.e),t.Y36(d.F0))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-tracks"]],viewQuery:function(e,n){if(1&e&&t.Gf(r.ki,5),2&e){let i;t.iGM(i=t.CRH())&&(n.modal=i.first)}},standalone:!0,features:[t.jDz],decls:23,vars:5,consts:[["slot","start"],["defaultHref","/"],[3,"ngModel","ngModelChange",4,"ngIf"],["slot","end"],[3,"click",4,"ngIf"],["id","open-modal","size","small"],["name","add"],["id","searchBar"],["mode","ios","placeholder","Introduce el nombre de la canci\xf3n",3,"ngModel","keyup.enter","ngModelChange"],[3,"click"],["slot","end","name","search"],["id","container"],["trigger","open-modal",3,"willDismiss"],[3,"fixed"],[1,"ion-justify-content-center"],["button","",4,"ngFor","ngForOf"],[3,"ngModel","ngModelChange"],[3,"value","click",4,"ngFor","ngForOf"],[3,"value","click"],["color","primary",3,"strong","click"],[1,"ion-padding"],["position","stacked"],["type","text","aria-label","Nombre","placeholder","Nombre de la canci\xf3n",3,"ngModel","ngModelChange"],["type","text","aria-label","Artista","placeholder","Artista o grupo",3,"ngModel","ngModelChange"],["type","text","aria-label","URL","placeholder","URL de la imagen",3,"ngModel","ngModelChange"],["button",""],["size","small",3,"click",4,"ngIf"],["id","img-container"],[3,"src"],["id","card-info"],[4,"ngFor","ngForOf"],["size","small",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t.YNc(5,v,2,2,"ion-segment",2),t.qZA(),t.TgZ(6,"ion-buttons",3),t.YNc(7,s,2,1,"ion-button",4),t.TgZ(8,"ion-fab-button",5),t._UZ(9,"ion-icon",6),t.qZA()()(),t.TgZ(10,"ion-toolbar")(11,"div",7)(12,"ion-searchbar",8),t.NdJ("keyup.enter",function(){return n.search()})("ngModelChange",function(g){return n.query=g}),t.qZA(),t.TgZ(13,"ion-button",9),t.NdJ("click",function(){return n.search()}),t._UZ(14,"ion-icon",10),t._uU(15," Buscar "),t.qZA()()()(),t.TgZ(16,"ion-content")(17,"div",11)(18,"ion-modal",12),t.NdJ("willDismiss",function(g){return n.onWillDismiss(g)}),t.YNc(19,c,22,4,"ng-template"),t.qZA(),t.TgZ(20,"ion-grid",13)(21,"ion-row",14),t.YNc(22,C,16,8,"ion-card",15),t.qZA()()()()),2&e&&(t.xp6(5),t.Q6J("ngIf",!n.toggleInsert),t.xp6(2),t.Q6J("ngIf",n.displayInsert),t.xp6(5),t.Q6J("ngModel",n.query),t.xp6(8),t.Q6J("fixed",!0),t.xp6(2),t.Q6J("ngForOf",n.tracks))},dependencies:[u.ez,u.sg,u.O5,u.uU,_.u5,_.JJ,_.On,r.Pc,r.oU,r.YG,r.Sm,r.PM,r.W2,r.IJ,r.W4,r.jY,r.Gu,r.gu,r.Xz,r.pK,r.Ie,r.Q$,r.Nd,r.VI,r.cJ,r.GO,r.wd,r.sr,r.ki,r.QI,r.j9,r.cs,d.Bz],styles:['ion-card[_ngcontent-%COMP%]{width:200px;position:relative;height:300px;background-color:#000;transition:.5s}ion-card[_ngcontent-%COMP%]:hover{transform:scale(1.1)}ion-img[_ngcontent-%COMP%]{height:100%}ion-card[_ngcontent-%COMP%]   ion-fab[_ngcontent-%COMP%]{position:absolute;z-index:1;top:0;right:0}#img-container[_ngcontent-%COMP%]{position:relative}#img-container[_ngcontent-%COMP%]:after{content:"";position:absolute;left:0;top:0;width:100%;height:100%;background:linear-gradient(to bottom,rgba(255,255,255,0) 0,black 100%)}#card-info[_ngcontent-%COMP%]{position:absolute;bottom:0;width:100%}#card-info[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{background-color:#000;color:#fff;text-align:center;border-radius:5px;margin:0 auto;width:max-content;padding:0 10px;max-width:80%;box-shadow:0 0 130px 30px var(--ion-color-primary)}#searchBar[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:500px;margin:0 auto}#searchBar[_ngcontent-%COMP%]   ion-searchbar[_ngcontent-%COMP%]{padding:0 20px}ion-segment[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;margin:0 auto}']}),o})()},721:(A,T,a)=>{a.r(T),a.d(T,{routes:()=>_});const _=[{path:"",component:a(9226).H},{path:":id",loadComponent:()=>a.e(6845).then(a.bind(a,6845)).then(d=>d.TrackPage)}]},5013:(A,T,a)=>{a.d(T,{j:()=>P});var u=a(9646),_=a(4004),d=a(262),r=a(2340),x=a(9226),f=a(4650),b=a(529),t=a(7556);let P=(()=>{class h{constructor(s,c){this.http=s,this.authService=c,this.url=r.N.url,this.token=this.authService.getJWT()}searchTracksSpotify(s){return this.http.get(`${this.url}search/${encodeURI(s)}`).pipe((0,_.U)(c=>c.tracks.items.map(M=>({_id:M.id,...M,id:void 0}))))}searchTracks(s,c=x.a.name){return this.http.get(`${this.url}tracks/search?${c}=${encodeURI(s)}`,{headers:{Authorization:`Bearer ${this.token}`}}).pipe((0,_.U)(m=>m))}getTrack(s){return this.http.get(`${this.url}tracks/${s}`,{headers:{Authorization:`Bearer ${this.token}`}}).pipe((0,_.U)(c=>c))}getTracks(){return this.http.get(`${this.url}tracks/`,{headers:{Authorization:`Bearer ${this.token}`}}).pipe((0,_.U)(s=>s))}insertTrack(s){this.http.post(`${this.url}tracks/`,s,{headers:{Authorization:`Bearer ${this.token}`}}).pipe((0,d.K)(c=>(0,u.of)(c.error))).subscribe(c=>{console.log(c)})}insertComment(s,c){return this.http.post(`${this.url}tracks/${s}/comments`,c,{headers:{Authorization:`Bearer ${this.token}`}}).pipe((0,d.K)(m=>(0,u.of)(m.error))).subscribe(m=>m),(0,u.of)(c)}getComments(s){return this.http.get(`${this.url}tracks/${s}/comments`,{headers:{Authorization:`Bearer ${this.token}`}}).pipe((0,_.U)(c=>c))}}return h.\u0275fac=function(s){return new(s||h)(f.LFG(b.eN),f.LFG(t.e))},h.\u0275prov=f.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()}}]);